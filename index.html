<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Nordi ðŸ’˜</title>

  <!-- Confetti library -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <style>
    :root{
      --bg1:#ffd6e7;
      --bg2:#ffeef6;
      --card:#ffffffcc;
      --yes:#ff3b7a;
      --yesHover:#ff1f68;
      --text:#111827;
      --muted:#6b7280;
      --shadow: 0 18px 60px rgba(0,0,0,.15);

      /* sizes */
      --dogSize: 200px;        /* <-- perro grande */
      --iconBox: 46px;         /* caja de iconos */
      --iconEmoji: 26px;       /* emoji dentro */
      --btnFont: 18px;
      --btnPadY: 16px;
      --btnPadX: 28px;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      min-height:100svh;
      display:grid;
      place-items:center;
      background: radial-gradient(circle at top, var(--bg2), var(--bg1));
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      overflow:hidden;
      padding:16px;
      color: var(--text);
    }

    /* FULL-SCREEN CONFETTI CANVAS */
    #confettiCanvas{
      position:fixed;
      inset:0;
      width:100vw;
      height:100vh;
      pointer-events:none;
      z-index:9999;
    }

    .card{
      width:min(820px, 94vw);
      padding: 26px 22px 26px;
      background: var(--card);
      backdrop-filter: blur(10px);
      border-radius: 26px;
      text-align:center;
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;

      /* cursor heart everywhere inside card (incl. 2nd screen) */
      cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='36' height='36' viewBox='0 0 36 36'%3E%3Cpath d='M18 31s-9-5.7-12.8-11.2C2.3 15.1 4.2 9.7 9 8.4c2.6-.7 5.3.2 7 2 1.7-1.8 4.4-2.7 7-2 4.8 1.3 6.7 6.7 3.8 11.4C27 25.3 18 31 18 31z' fill='%23ff3b7a'/%3E%3C/svg%3E") 16 16, auto;
    }

    .card::before{
      content:"";
      position:absolute;
      inset:-80px;
      background:
        radial-gradient(circle at 10% 12%, rgba(255,59,122,.18), transparent 45%),
        radial-gradient(circle at 90% 86%, rgba(34,197,94,.16), transparent 45%),
        radial-gradient(circle at 65% 20%, rgba(255,255,255,.30), transparent 35%);
      pointer-events:none;
      z-index:0;
    }
    .card > *{ position:relative; z-index:1; }

    .top-icons{
      display:flex;
      justify-content:center;
      gap:14px;
      align-items:center;
      margin-top:2px;
      margin-bottom:10px;
      user-select:none;
    }

    .icon{
      display:inline-grid;
      place-items:center;
      width: var(--iconBox);
      height: var(--iconBox);
      border-radius: 14px;
      background: rgba(255,255,255,.60);
      box-shadow: 0 10px 22px rgba(0,0,0,.10);
      transform: translateZ(0);
    }
    .icon span{ font-size: var(--iconEmoji); line-height:1; }

    .heart-beat{
      animation: beat 1.25s ease-in-out infinite;
      transform-origin:center;
    }
    @keyframes beat{
      0%,100%{ transform: scale(1); }
      30%{ transform: scale(1.12); }
      55%{ transform: scale(1.00); }
    }

    /* dog */
    .hero{
      display:grid;
      place-items:center;
      margin: 6px 0 10px;
    }
    .chihuahua-img{
      width: var(--dogSize);
      height: auto;
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.12));
      transform: translateZ(0);
      animation: breathe 3.8s ease-in-out infinite;
      transform-origin:center;
      user-select:none;
      pointer-events:none;
    }
    @keyframes breathe{
      0%,100%{ transform: scale(1); }
      50%{ transform: scale(1.015); }
    }
    .jump{ animation: jump .26s ease; }
    @keyframes jump{
      0%{ transform: translateY(0) scale(1); }
      45%{ transform: translateY(-10px) scale(1.01); }
      100%{ transform: translateY(0) scale(1); }
    }

    h1{
      font-size: clamp(26px, 4vw, 44px);
      margin: 10px 0 14px;
      letter-spacing: -0.5px;
    }

    .button-zone{
      position:relative;
      width:min(560px, 95%);
      height: 170px;
      margin: 12px auto 4px;
      touch-action:none;
    }

    button{
      position:absolute;
      top:50%;
      transform: translateY(-50%);
      padding: var(--btnPadY) var(--btnPadX);
      font-size: var(--btnFont);
      font-weight: 900;
      border-radius: 999px;
      border:none;
      cursor:pointer;
      box-shadow: 0 10px 24px rgba(0,0,0,.14);
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transition: transform .12s ease, background .12s ease, filter .12s ease;
      will-change: transform, left, top;
    }

    #yesBtn{
      left: 22%;
      background: var(--yes);
      color:#fff;
    }
    #yesBtn:hover{ background: var(--yesHover); }

    #noBtn{
      left: 62%;
      background: #e5e7eb;
      color:#111827;
    }

    /* Trail sprites */
    .trail{
      position: absolute;
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: rgba(255,59,122,.28);
      box-shadow: 0 6px 16px rgba(0,0,0,.12);
      pointer-events:none;
      animation: trailFade .55s ease forwards;
    }
    @keyframes trailFade{
      0%{ transform: scale(1); opacity: .9; }
      100%{ transform: scale(.15); opacity: 0; }
    }

    /* Result section */
    .result{
      display:none;
      margin-top: 14px;
      animation: pop .35s ease;
    }
    @keyframes pop{
      from{ transform: scale(.96); opacity:0; }
      to{ transform: scale(1); opacity:1; }
    }

    .accepted{
      font-size: clamp(30px, 4.5vw, 52px);
      margin: 8px 0 6px;
      font-weight: 950;
      letter-spacing: -0.6px;
    }
    .tagline{
      margin: 0 0 12px;
      font-size: 14px;
      opacity: .92;
      font-weight: 750;
    }

    .fireworks{
      width: min(420px, 92vw);
      display:block;
      margin: 12px auto 14px;
      border-radius: 18px;
      box-shadow: 0 14px 40px rgba(0,0,0,.16);
    }

    .whats{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding: 14px 20px;
      border-radius: 999px;
      text-decoration:none;
      font-weight: 950;
      background: #22c55e;
      color: #fff;
      box-shadow: 0 12px 30px rgba(0,0,0,.16);
      transition: transform .12s ease, filter .12s ease;
    }
    .whats:hover{ transform: translateY(-1px) scale(1.01); filter: brightness(1.02); }

    /* Make top icons bounce when No runs */
    .carrot-bounce{ animation: carrot .26s ease; }
    @keyframes carrot{
      0%{ transform: translateY(0) rotate(0deg); }
      45%{ transform: translateY(-10px) rotate(-8deg); }
      100%{ transform: translateY(0) rotate(0deg); }
    }

    @media (max-width: 520px){
      .button-zone{ height: 185px; }
      #yesBtn{ left: 18%; }
      #noBtn{ left: 62%; }
      :root{ --dogSize: 180px; }
    }
  </style>
</head>

<body>
  <canvas id="confettiCanvas"></canvas>

  <main class="card" id="card">
    <div class="top-icons">
      <div class="icon" id="carrotIcon" title="ðŸ¥•"><span>ðŸ¥•</span></div>
      <div class="icon" title="ðŸ’—"><span class="heart-beat">ðŸ’—</span></div>
    </div>

    <div class="hero" aria-hidden="true">
      <!-- IMPORTANTE: este archivo debe existir en tu repo -->
      <img class="chihuahua-img" id="chihuahuaImg" src="chihuahua.png" alt="chihuahua" />
    </div>

    <h1 id="titleText">Nordi, will you be my Valentine?</h1>

    <section class="button-zone" id="zone">
      <button id="yesBtn">Yes</button>
      <button id="noBtn">No</button>
    </section>

    <!-- RESULT (2nd screen) -->
    <section class="result" id="result">
      <div class="accepted">ðŸ¥• aceptasteee :) ðŸ’—</div>
      <div class="tagline">Trae hambre y cero excusas.</div>

      <img
        class="fireworks"
        src="https://media.giphy.com/media/26ufdipQqU2lhNA4g/giphy.gif"
        alt="Fireworks"
      />

      <a class="whats" id="waLink" target="_blank" rel="noopener">
        Abrir WhatsApp ðŸ’¬
      </a>
    </section>
  </main>

  <script>
    /* ---------------- ELEMENTS ---------------- */
    const zone = document.getElementById("zone");
    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");
    const result = document.getElementById("result");
    const carrotIcon = document.getElementById("carrotIcon");
    const chihuahuaImg = document.getElementById("chihuahuaImg");
    const waLink = document.getElementById("waLink");

    /* WhatsApp */
    const phone = "34641920721"; // +34 641 920 721
    const msg = encodeURIComponent("SHE SAID YES ðŸ’˜ðŸ¥•");
    waLink.href = `https://wa.me/${phone}?text=${msg}`;

    /* ---------- CONFETTI ---------- */
    const confettiCanvas = document.getElementById("confettiCanvas");

    function resizeConfettiCanvas() {
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      confettiCanvas.width = Math.floor(window.innerWidth * dpr);
      confettiCanvas.height = Math.floor(window.innerHeight * dpr);
      confettiCanvas.style.width = "100vw";
      confettiCanvas.style.height = "100vh";
    }
    resizeConfettiCanvas();
    window.addEventListener("resize", resizeConfettiCanvas);
    window.addEventListener("orientationchange", () => setTimeout(resizeConfettiCanvas, 150));

    const confettiInstance = confetti.create(confettiCanvas, { resize: false, useWorker: true });

    function fullScreenConfetti() {
      const end = Date.now() + 1700;
      (function frame() {
        confettiInstance({
          particleCount: 12,
          spread: 90,
          startVelocity: 45,
          ticks: 180,
          origin: { x: Math.random(), y: Math.random() * 0.3 }
        });
        if (Date.now() < end) requestAnimationFrame(frame);
      })();

      setTimeout(() => {
        confettiInstance({
          particleCount: 320,
          spread: 140,
          startVelocity: 62,
          ticks: 240,
          origin: { x: 0.5, y: 0.55 }
        });
      }, 320);
    }

    /* ---------- YES BUTTON GROWS ---------- */
    let yesScale = 1;
    function growYes() {
      yesScale = Math.min(2.25, yesScale + 0.1);
      yesBtn.style.transform = `translateY(-50%) scale(${yesScale})`;
    }

    /* ---------- NO BUTTON RUNS AWAY + TRAIL ---------- */
    function clamp(n, min, max) { return Math.max(min, Math.min(max, n)); }

    function spawnTrail(x, y) {
      const z = zone.getBoundingClientRect();
      const t = document.createElement("div");
      t.className = "trail";
      t.style.left = (x - z.left - 7) + "px";
      t.style.top = (y - z.top - 7) + "px";
      zone.appendChild(t);
      setTimeout(() => t.remove(), 650);
    }

    function nudgeCarrotAndDog() {
      carrotIcon.classList.remove("carrot-bounce");
      chihuahuaImg.classList.remove("jump");
      void carrotIcon.offsetWidth;
      void chihuahuaImg.offsetWidth;
      carrotIcon.classList.add("carrot-bounce");
      chihuahuaImg.classList.add("jump");
    }

    function moveNo(px, py) {
      const z = zone.getBoundingClientRect();
      const b = noBtn.getBoundingClientRect();

      let dx = (b.left + b.width / 2) - px;
      let dy = (b.top + b.height / 2) - py;
      let mag = Math.hypot(dx, dy) || 1;
      dx /= mag; dy /= mag;

      let newLeft = (b.left - z.left) + dx * 160;
      let newTop  = (b.top - z.top) + dy * 160;

      newLeft = clamp(newLeft, 0, z.width - b.width);
      newTop  = clamp(newTop, 0, z.height - b.height);

      spawnTrail(b.left + b.width/2, b.top + b.height/2);

      noBtn.style.left = newLeft + "px";
      noBtn.style.top = newTop + "px";
      noBtn.style.transform = "none";

      growYes();
      nudgeCarrotAndDog();
      playNoDodgeTick();
    }

    zone.addEventListener("pointermove", e => {
      const b = noBtn.getBoundingClientRect();
      const d = Math.hypot(
        (b.left + b.width / 2) - e.clientX,
        (b.top + b.height / 2) - e.clientY
      );
      if (d < 150) moveNo(e.clientX, e.clientY);
    });

    noBtn.addEventListener("click", e => e.preventDefault());

    /* ---------- AUDIO (WebAudio) ---------- */
    let audioCtx = null;
    let master = null;
    let pianoOn = false;
    let firstInteractionDone = false;

    function ensureAudio() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        master = audioCtx.createGain();
        master.gain.value = 0.22;
        master.connect(audioCtx.destination);
      }
      if (audioCtx.state === "suspended") audioCtx.resume();
    }

    function pianoNote(freq, t, dur, vel=0.7) {
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = "triangle";
      o.frequency.setValueAtTime(freq, t);

      g.gain.setValueAtTime(0.0001, t);
      g.gain.exponentialRampToValueAtTime(vel, t + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, t + dur);

      const f = audioCtx.createBiquadFilter();
      f.type = "lowpass";
      f.frequency.setValueAtTime(2200, t);

      o.connect(f); f.connect(g); g.connect(master);
      o.start(t); o.stop(t + dur + 0.05);
    }

    let pianoTimer = null;
    function startPianoLoop() {
      if (pianoOn) return;
      pianoOn = true;

      const seq = [
        [220.00, 261.63, 329.63],
        [174.61, 220.00, 261.63],
        [196.00, 246.94, 293.66],
        [164.81, 196.00, 246.94],
      ];

      let step = 0;
      function tick() {
        const now = audioCtx.currentTime;
        const chord = seq[step % seq.length];
        pianoNote(chord[0], now + 0.00, 0.60, 0.35);
        pianoNote(chord[1], now + 0.22, 0.50, 0.30);
        pianoNote(chord[2], now + 0.44, 0.55, 0.28);
        step++;
      }

      tick();
      pianoTimer = setInterval(tick, 1200);
    }

    function stopPianoLoop() {
      pianoOn = false;
      if (pianoTimer) { clearInterval(pianoTimer); pianoTimer = null; }
    }

    function playNoDodgeTick() {
      if (!audioCtx || !pianoOn) return;
      const t = audioCtx.currentTime;
      pianoNote(523.25, t, 0.12, 0.18);
    }

    function brassNote(freq, t, dur, vel=0.7) {
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      const f = audioCtx.createBiquadFilter();

      o.type = "sawtooth";
      o.frequency.setValueAtTime(freq, t);

      f.type = "lowpass";
      f.frequency.setValueAtTime(1800, t);

      g.gain.setValueAtTime(0.0001, t);
      g.gain.exponentialRampToValueAtTime(vel, t + 0.02);
      g.gain.exponentialRampToValueAtTime(0.0001, t + dur);

      o.connect(f); f.connect(g); g.connect(master);
      o.start(t); o.stop(t + dur + 0.05);
    }

    function playVictoryFanfare() {
      const t = audioCtx.currentTime + 0.02;
      const notes = [
        [392.00, 0.00, 0.26, 0.55],
        [493.88, 0.28, 0.26, 0.60],
        [587.33, 0.56, 0.30, 0.65],
        [659.25, 0.88, 0.32, 0.70],
        [783.99, 1.22, 0.48, 0.78],
        [659.25, 1.74, 0.28, 0.55],
        [783.99, 2.02, 0.38, 0.75],
      ];
      notes.forEach(([f, off, dur, v]) => brassNote(f, t + off, dur, v));
    }

    function onFirstUserGesture() {
      if (firstInteractionDone) return;
      firstInteractionDone = true;
      ensureAudio();
      startPianoLoop();
    }
    window.addEventListener("pointerdown", onFirstUserGesture, { once: true });

    /* ---------- YES CLICK ---------- */
    yesBtn.addEventListener("click", () => {
      ensureAudio();
      stopPianoLoop();
      playVictoryFanfare();

      zone.style.display = "none";
      result.style.display = "block";

      resizeConfettiCanvas();
      fullScreenConfetti();

      // opcional: abrir WhatsApp tras un mini-delay (si quieres automÃ¡tico)
      // setTimeout(() => { window.open(waLink.href, "_blank"); }, 650);
    });
  </script>
</body>
</html>
